# ç§»åŠ¨ç«¯å¼€å‘æ¦‚è¿°

æµ·ç‹¸IMç§»åŠ¨ç«¯åŸºäºuni-appæ¡†æ¶å¼€å‘ï¼Œé‡‡ç”¨Vue 3 + TypeScriptæŠ€æœ¯æ ˆï¼Œæ”¯æŒiOSã€Androidã€å°ç¨‹åºç­‰å¤šå¹³å°ä¸€ç å¤šç«¯ã€‚

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **æ¡†æ¶**: uni-app 3.0+
- **å‰ç«¯**: Vue 3.5+ + TypeScript 4.9+
- **æ„å»ºå·¥å…·**: Vite 5.2+
- **çŠ¶æ€ç®¡ç†**: Pinia 2.2+
- **UIæ¡†æ¶**: è‡ªå®šä¹‰ç»„ä»¶åº“
- **é€šä¿¡åè®®**: WebSocket + HTTP API
- **æ•°æ®å­˜å‚¨**: uni.setStorage / SQLite
- **å¤šåª’ä½“**: uni-appåª’ä½“API

### æ¶æ„ç‰¹ç‚¹

- **ä¸€ç å¤šç«¯**: ä¸€å¥—ä»£ç ç¼–è¯‘åˆ°iOSã€Androidã€å°ç¨‹åº
- **åŸç”Ÿæ€§èƒ½**: æ¥è¿‘åŸç”Ÿåº”ç”¨çš„æ€§èƒ½ä½“éªŒ
- **è·¨å¹³å°å…¼å®¹**: ç»Ÿä¸€çš„APIï¼Œå¹³å°å·®å¼‚æœ€å°åŒ–
- **ä¸°å¯Œç”Ÿæ€**: uni-appæ’ä»¶å¸‚åœºèµ„æºä¸°å¯Œ
- **çƒ­æ›´æ–°**: æ”¯æŒçƒ­æ›´æ–°æœºåˆ¶

## å¹³å°æ”¯æŒ

### ğŸ“± ç§»åŠ¨å¹³å°

- **iOS**: åŸç”ŸiOSåº”ç”¨ (iOS 11+)
- **Android**: åŸç”ŸAndroidåº”ç”¨ (Android 7.0+)
- **HarmonyOS**: é¸¿è’™ç³»ç»Ÿæ”¯æŒ

### ğŸŒ å°ç¨‹åºå¹³å°

- **å¾®ä¿¡å°ç¨‹åº**: æ”¯æŒå¾®ä¿¡ç”Ÿæ€
- **æ”¯ä»˜å®å°ç¨‹åº**: æ”¯ä»˜å®ç”Ÿæ€é›†æˆ
- **æŠ–éŸ³å°ç¨‹åº**: å­—èŠ‚è·³åŠ¨ç”Ÿæ€
- **ç™¾åº¦å°ç¨‹åº**: ç™¾åº¦ç”Ÿæ€æ”¯æŒ
- **QQå°ç¨‹åº**: QQç”Ÿæ€æ”¯æŒ

### ğŸ’» å…¶ä»–å¹³å°

- **H5**: æ‰‹æœºæµè§ˆå™¨è®¿é—®
- **å¿«åº”ç”¨**: åä¸ºã€å°ç±³ç­‰å¿«åº”ç”¨å¹³å°

## åº”ç”¨ç‰¹æ€§

### ğŸ’¬ èŠå¤©åŠŸèƒ½

- **å®æ—¶æ¶ˆæ¯**: WebSocketå®æ—¶æ¶ˆæ¯æ”¶å‘
- **å¤šåª’ä½“æ¶ˆæ¯**: æ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³ã€è§†é¢‘ã€ä½ç½®
- **è¡¨æƒ…åŒ…**: ä¸°å¯Œçš„è¡¨æƒ…åŒ…å’Œè‡ªå®šä¹‰è¡¨æƒ…
- **æ¶ˆæ¯çŠ¶æ€**: å‘é€ä¸­ã€å·²é€è¾¾ã€å·²è¯»çŠ¶æ€
- **æ’¤å›åŠŸèƒ½**: 2åˆ†é’Ÿå†…æ¶ˆæ¯æ’¤å›
- **è½¬å‘åŠŸèƒ½**: æ¶ˆæ¯è½¬å‘å’Œåˆå¹¶è½¬å‘

### ğŸ‘¥ ç¤¾äº¤åŠŸèƒ½

- **å¥½å‹ç®¡ç†**: æ·»åŠ ã€åˆ é™¤ã€å¤‡æ³¨å¥½å‹
- **ç¾¤ç»„èŠå¤©**: åˆ›å»ºã€ç®¡ç†ç¾¤ç»„
- **æœ‹å‹åœˆ**: åŠ¨æ€å‘å¸ƒå’Œäº’åŠ¨
- **ç”¨æˆ·èµ„æ–™**: ä¸ªäººä¿¡æ¯å±•ç¤ºå’Œç¼–è¾‘
- **åœ¨çº¿çŠ¶æ€**: å®æ—¶åœ¨çº¿çŠ¶æ€æ˜¾ç¤º

### ğŸ”” æ¶ˆæ¯æ¨é€

- **ç¦»çº¿æ¨é€**: æ”¯æŒå‚å•†æ¨é€é€šé“
- **æ¶ˆæ¯å…æ‰“æ‰°**: ç¾¤ç»„å’Œå¥½å‹å…æ‰“æ‰°è®¾ç½®
- **æ¨é€ç­–ç•¥**: æ™ºèƒ½æ¨é€ç­–ç•¥
- **é€šçŸ¥è®¾ç½®**: ä¸ªæ€§åŒ–é€šçŸ¥è®¾ç½®

### ğŸ¨ ç•Œé¢ä½“éªŒ

- **æš—é»‘æ¨¡å¼**: æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- **å­—ä½“å¤§å°**: å¯è°ƒèŠ‚å­—ä½“å¤§å°
- **èŠå¤©èƒŒæ™¯**: ä¸ªæ€§åŒ–èŠå¤©èƒŒæ™¯
- **æ‰‹åŠ¿æ“ä½œ**: æ»‘åŠ¨æ“ä½œå’Œé•¿æŒ‰èœå•

## é¡¹ç›®ç»“æ„

```
beaver-mobile/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ chat/            # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/          # å…¬å…±ç»„ä»¶
â”‚   â”‚   â””â”€â”€ media/           # å¤šåª’ä½“ç»„ä»¶
â”‚   â”œâ”€â”€ pages/               # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index/           # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ chat/            # èŠå¤©é¡µé¢
â”‚   â”‚   â”œâ”€â”€ contacts/        # è”ç³»äºº
â”‚   â”‚   â”œâ”€â”€ discover/        # å‘ç°é¡µ
â”‚   â”‚   â”œâ”€â”€ profile/         # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ login/           # ç™»å½•æ³¨å†Œ
â”‚   â”œâ”€â”€ static/              # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/          # å›¾ç‰‡èµ„æº
â”‚   â”‚   â”œâ”€â”€ fonts/           # å­—ä½“æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ emoji/           # è¡¨æƒ…åŒ…
â”‚   â”œâ”€â”€ store/               # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ modules/         # çŠ¶æ€æ¨¡å—
â”‚   â”‚   â””â”€â”€ index.ts         # çŠ¶æ€å…¥å£
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts       # ç½‘ç»œè¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ websocket.ts     # WebSocketç®¡ç†
â”‚   â”‚   â”œâ”€â”€ storage.ts       # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â””â”€â”€ permission.ts    # æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ types/               # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ uni_modules/         # uni-appæ’ä»¶
â”œâ”€â”€ pages.json               # é¡µé¢é…ç½®
â”œâ”€â”€ manifest.json            # åº”ç”¨é…ç½®
â”œâ”€â”€ uni.scss                 # å…¨å±€æ ·å¼
â”œâ”€â”€ package.json            # é¡¹ç›®é…ç½®
â””â”€â”€ vite.config.ts          # æ„å»ºé…ç½®
```

## ç•Œé¢å±•ç¤º

> ğŸ“¸ **[æŸ¥çœ‹å®Œæ•´ç•Œé¢æˆªå›¾ â†’](/mobile/screenshots)**

## æ ¸å¿ƒæ¨¡å—

### 1. æ¶ˆæ¯ç®¡ç†

```typescript
// src/utils/message.ts
export class MessageManager {
  private messages: Map<string, Message[]> = new Map()
  
  // å‘é€æ¶ˆæ¯
  async sendMessage(conversationId: string, content: any) {
    const message = {
      id: generateId(),
      conversationId,
      content,
      timestamp: Date.now(),
      status: 'sending'
    }
    
    this.addMessage(conversationId, message)
    await this.uploadToServer(message)
  }
  
  // æ¥æ”¶æ¶ˆæ¯
  receiveMessage(message: Message) {
    this.addMessage(message.conversationId, message)
    this.updateUnreadCount(message.conversationId)
  }
}
```

### 2. WebSocketè¿æ¥

```typescript
// src/utils/websocket.ts
export class WebSocketManager {
  private ws: WebSocket | null = null
  private heartbeatTimer: number | null = null
  
  connect(url: string, token: string) {
    this.ws = new WebSocket(url)
    this.setupEventHandlers()
    this.startHeartbeat()
  }
  
  private setupEventHandlers() {
    this.ws!.onopen = this.handleOpen
    this.ws!.onmessage = this.handleMessage
    this.ws!.onclose = this.handleReconnect
  }
}
```

### 3. çŠ¶æ€ç®¡ç†

```typescript
// src/store/modules/user.ts
export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: null as UserInfo | null,
    token: '',
    isLogin: false
  }),
  
  actions: {
    async login(loginData: LoginData) {
      const res = await api.login(loginData)
      this.userInfo = res.data.userInfo
      this.token = res.data.token
      this.isLogin = true
      
      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      uni.setStorageSync('userInfo', this.userInfo)
      uni.setStorageSync('token', this.token)
    }
  }
})
```

### 4. å¤šåª’ä½“å¤„ç†

```typescript
// src/utils/media.ts
export class MediaManager {
  // é€‰æ‹©å›¾ç‰‡
  static chooseImage() {
    return new Promise((resolve, reject) => {
      uni.chooseImage({
        count: 9,
        sourceType: ['album', 'camera'],
        success: resolve,
        fail: reject
      })
    })
  }
  
  // å½•åˆ¶éŸ³é¢‘
  static recordAudio() {
    const recorderManager = uni.getRecorderManager()
    recorderManager.start({
      duration: 60000,
      sampleRate: 16000,
      numberOfChannels: 1,
      encodeBitRate: 48000,
      format: 'mp3'
    })
    return recorderManager
  }
}
```

## å¹³å°é€‚é…

### iOSé€‚é…

```json
// manifest.json - iOSé…ç½®
{
  "app-plus": {
    "iOS": {
      "privacyDescription": {
        "NSCameraUsageDescription": "ç”¨äºæ‹ç…§å‘é€å›¾ç‰‡",
        "NSPhotoLibraryUsageDescription": "ç”¨äºé€‰æ‹©ç›¸å†Œå›¾ç‰‡",
        "NSMicrophoneUsageDescription": "ç”¨äºå½•åˆ¶è¯­éŸ³æ¶ˆæ¯"
      },
      "capabilities": {
        "entitlements": {
          "com.apple.developer.associated-domains": [
            "applinks:yourdomain.com"
          ]
        }
      }
    }
  }
}
```

### Androidé€‚é…

```json
// manifest.json - Androidé…ç½®
{
  "app-plus": {
    "Android": {
      "permissions": [
        "<uses-permission android:name=\"android.permission.CAMERA\" />",
        "<uses-permission android:name=\"android.permission.RECORD_AUDIO\" />",
        "<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />"
      ],
      "targetSdkVersion": 33,
      "compileSdkVersion": 33
    }
  }
}
```

## åŠŸèƒ½å®ç°

### 1. èŠå¤©ç•Œé¢

```vue
<!-- src/pages/chat/chat.vue -->
<template>
  <view class="chat-container">
    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <scroll-view class="message-list" :scroll-top="scrollTop">
      <message-item
        v-for="message in messages"
        :key="message.id"
        :message="message"
        @resend="resendMessage"
      />
    </scroll-view>
    
    <!-- è¾“å…¥åŒºåŸŸ -->
    <view class="input-area">
      <input
        v-model="inputText"
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        @confirm="sendMessage"
      />
      <button @click="sendMessage">å‘é€</button>
    </view>
  </view>
</template>
```

### 2. å¥½å‹åˆ—è¡¨

```vue
<!-- src/pages/contacts/contacts.vue -->
<template>
  <view class="contacts-container">
    <uni-search-bar
      v-model="searchText"
      placeholder="æœç´¢è”ç³»äºº"
      @input="searchContacts"
    />
    
    <uni-list>
      <uni-list-item
        v-for="friend in friendList"
        :key="friend.id"
        :title="friend.nickname"
        :thumb="friend.avatar"
        @click="openChat(friend)"
      />
    </uni-list>
  </view>
</template>
```

### 3. æ¶ˆæ¯æ¨é€

```typescript
// src/utils/push.ts
export class PushManager {
  // åˆå§‹åŒ–æ¨é€
  static init() {
    // #ifdef APP-PLUS
    const pushManager = plus.push
    pushManager.addEventListener('click', this.handlePushClick)
    pushManager.addEventListener('receive', this.handlePushReceive)
    // #endif
  }
  
  // å¤„ç†æ¨é€ç‚¹å‡»
  static handlePushClick(message: any) {
    // è·³è½¬åˆ°å¯¹åº”èŠå¤©é¡µé¢
    uni.navigateTo({
      url: `/pages/chat/chat?conversationId=${message.payload.conversationId}`
    })
  }
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. åˆ—è¡¨ä¼˜åŒ–

- è™šæ‹Ÿæ»šåŠ¨ï¼šé•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- æ‡’åŠ è½½ï¼šå›¾ç‰‡å’Œç»„ä»¶æ‡’åŠ è½½
- åˆ†é¡µåŠ è½½ï¼šæ¶ˆæ¯å†å²åˆ†é¡µåŠ è½½

### 2. å†…å­˜ä¼˜åŒ–

- å›¾ç‰‡å‹ç¼©ï¼šå‘é€å‰å‹ç¼©å›¾ç‰‡
- ç¼“å­˜ç®¡ç†ï¼šåˆç†çš„ç¼“å­˜ç­–ç•¥
- å†…å­˜å›æ”¶ï¼šåŠæ—¶æ¸…ç†æ— ç”¨æ•°æ®

### 3. ç½‘ç»œä¼˜åŒ–

- è¯·æ±‚åˆå¹¶ï¼šæ‰¹é‡è¯·æ±‚ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥ï¼šæ¥å£æ•°æ®ç¼“å­˜
- é‡è¿æœºåˆ¶ï¼šç½‘ç»œå¼‚å¸¸é‡è¿

## å‘å¸ƒæµç¨‹

### 1. ç‰ˆæœ¬ç®¡ç†

```json
// package.json
{
  "version": "1.0.0",
  "versionCode": "100"
}
```

### 2. æ‰“åŒ…é…ç½®

```bash
# iOSæ‰“åŒ…
npm run build:app-ios

# Androidæ‰“åŒ…
npm run build:app-android

# å°ç¨‹åºæ‰“åŒ…
npm run build:mp-weixin
```

### 3. ä¸Šæ¶æµç¨‹

- **App Store**: é€šè¿‡HBuilderXäº‘æ‰“åŒ…iOS
- **Google Play**: Android AABæ ¼å¼ä¸Šæ¶
- **å›½å†…åº”ç”¨å¸‚åœº**: å„å¤§Androidåº”ç”¨å¸‚åœº
- **å°ç¨‹åº**: å¾®ä¿¡å¼€å‘è€…å·¥å…·å‘å¸ƒ

## è°ƒè¯•å·¥å…·

### 1. å¼€å‘è°ƒè¯•

```bash
# H5è°ƒè¯•
npm run dev:h5

# å¾®ä¿¡å°ç¨‹åºè°ƒè¯•
npm run dev:mp-weixin

# Appè°ƒè¯•ï¼ˆéœ€è¦HBuilderXï¼‰
npm run dev:app-android
```

### 2. çœŸæœºè°ƒè¯•

- HBuilderXçœŸæœºè¿è¡Œ
- å¾®ä¿¡å¼€å‘è€…å·¥å…·è°ƒè¯•
- Safariè¿œç¨‹è°ƒè¯•iOS
- Chromeè¿œç¨‹è°ƒè¯•Android

## ä¸‹ä¸€æ­¥

- [æŠ€æœ¯æ ˆè¯¦è§£](./tech-stack.md) - æ·±å…¥äº†è§£uni-appæŠ€æœ¯æ ˆ
- [é¡¹ç›®ç»“æ„](./structure.md) - è¯¦ç»†çš„é¡¹ç›®ç»“æ„è¯´æ˜
- [å¹³å°é€‚é…](./platform.md) - å„å¹³å°ç‰¹æ€§é€‚é…
- [å¼€å‘æŒ‡å—](./development.md) - æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º 